# Telegram Bot for BeatsByMorpho

Добро пожаловать в репозиторий **Telegram Bot for BeatsByMorpho**! Этот проект представляет собой Telegram-бота, разработанного для управления и распространения музыкальных битов. Бот позволяет пользователям загружать аудиофайлы, добавлять их в базу данных и публиковать в Telegram-канале, а также просматривать последние загруженные биты через команду `/beats`.

## Описание

Бот создан с использованием **Node.js** и библиотеки **grammy** для взаимодействия с Telegram Bot API. Он предназначен для энтузиастов музыки и продюсеров, предоставляя удобный способ обмена битами с сообществом. Основные возможности включают:
- Загрузку аудиофайлов в формате MP3.
- Парсинг метаданных (название, BPM, жанры).
- Публикацию битов в Telegram-канале.
- Просмотр последних 10 битов через команду `/beats`.
- Поддержку инструкций для пользователей через команду `/upload`.

## Установка

### Предварительные требования
- Node.js (версия 14.x или выше рекомендуется).
- Git.
- SQLite (для хранения данных о битах).
- Доступ к Telegram Bot API (токен от @BotFather).

### Клонирование репозитория
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/MakarLeonov/Telegram-Bot-for-BeatsByMorpho.git
   cd Telegram-Bot-for-BeatsByMorpho
   ```

### Настройка
1. Создайте файл `.env` в корневой директории и добавьте следующие переменные:
   ```
   BOT_API_KEY=ваш_токен_бота
   CHANNEL_ID=@username_вашего_канала_или_числовой_id
   ```
   - Получите `BOT_API_KEY`, обратившись к @BotFather в Telegram.
   - Узнайте `CHANNEL_ID`, отправив сообщение в канал и проверив `chat.id` через бота или документацию Telegram.

2. Установите зависимости:
   ```bash
   npm install
   ```

### Запуск
1. Запустите бота:
   ```bash
   node index.js
   ```
2. Бот начнет обрабатывать команды и сообщения. Убедитесь, что он добавлен как администратор в указанный канал (`CHANNEL_ID`).

## Использование

### Команды
- `/upload` — Показывает инструкции по загрузке бита.
- `/beats` — Показывает последние 10 загруженных битов в виде медиагруппы без подписей.

### Загрузка бита
1. Отправьте аудиофайл в формате MP3 боту.
2. (Опционально) Добавьте текст в подписи с метаданными:
   - Пример: `Cool Beat 140bpm #grizelda #detroit`
   - Название (до BPM или до хэштегов).
   - BPM (например, `100bpm`).
   - Жанры (хэштеги, например, `#jazz`).
   - Можно отправить без текста (в этом случае название не будет указано).
3. Бот сохранит бит в базу данных и опубликует его в канале.

### Примеры подписей
- Без текста: Бит публикуется с подписью `#beats_by_morpho`.
- `#jazz`: Подпись в канале: `#beats_by_morpho #jazz`.
- `100bpm #jazz`: Подпись в канале: `#beats_by_morpho #jazz`.
- `Cool Beat 100bpm #jazz`: Подпись в канале: `Cool Beat (100bpm)\n\n#beats_by_morpho #jazz`.

### Ответы бота
- После успешной загрузки: `Бит "Название" успешно добавлен!\nBPM: 100\nЖанры: #jazz` (если данные есть).
- Без названия: `Бит успешно добавлен!` (с указанием BPM и жанров, если они есть).

## Структура проекта

- `index.js` — Основной файл запуска бота.
- `features/` — Модули с функциональностью:
  - `addBeat.js` — Обработка загрузки битов.
  - `showBeats.js` — Отображение битов по команде `/beats`.
  - `startBot.js`, `links.js`, `faq.js`, `showTarifs.js`, `commandsMenu.js`, `catchErrors.js` — Дополнительные функции.
- `database/beatStore.js` — Модуль для работы с базой данных SQLite.
- `.env` — Файл с конфигурацией (не в репозитории, создается вручную).
- `beats.db` — Файл базы данных (создается автоматически).

## База данных
База данных хранит информацию о битах в таблице `beats` со следующими колонками:
- `id` — Уникальный идентификатор.
- `fileId` — ID аудиофайла от Telegram.
- `title` — Название бита (может быть `null`).
- `bpm` — Темп (может быть `null`).
- `genres` — Список жанров в формате JSON (может быть `null`).
- `created_at` — Дата и время создания записи.

## Разработка и вклад
- Проект открыт для улучшений. Приветствуются pull requests с новыми функциями или исправлениями.
- Сообщайте об ошибках через Issues на GitHub.

## Автор
- **МakarLeonov** — [GitHub профиль](https://github.com/MakarLeonov)
